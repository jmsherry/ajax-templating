<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=7">

    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">


    <title>Templating, AJAX &amp; APIs</title>
    <link rel="stylesheet" href="https://cdn.rawgit.com/twbs/bootstrap/v4-dev/dist/css/bootstrap.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.4.1/themes/prism.min.css">
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.4.1/themes/prism-twilight.min.css"> -->
    <link rel="stylesheet" href="./styles/styles.css">
</head>

<body>
    <header class="main-header">
        <div class="container">
            <h1 class="main-title">Templating, AJAX &amp; APIs</h1></div>
    </header>

    <section id="templating">
        <div class="container">
            <h2>Templating</h2>
            <p>Sometimes we want to put <abbr title="Hypertext Markup Language">HTML</abbr> into our page <strong>after</strong> the page has rendered. What if, for example, a product sold out? We could either let the user try to do the buying journey and fail, or
                we could adjust the page to let them know!</p>
            <div class="demo-area">
              <div class="demo-area-inner">
                <h3>Demo</h3>
                <p>We can create new <abbr title="Hypertext Markup Language">HTML</abbr> and put it into the page after load using javascript, like so:</p>

                <div class="controls">
                    <button class="btn btn-primary" id="inserter">Insert HTML</button>
                </div>

                <div id="templated-content" class="demo">
                    <div class="receiver"></div>
                </div>
              </div>
            </div>
            <h3>How it's done...</h3>
            <p>The process comes in a two parts:</p>
            <ol>
                <li>Construction of the new <abbr title="Hypertext Markup Language">HTML</abbr></li>
                <li>Insertion into the page</li>
            </ol>
            <h4>Insertion</h4>
            <p>Insertion (part 2) is quite easy:</p>
            <pre><code class="language-javascript">//either
document.getElementById('target').innerHtml = "&lt;p&gt;Hello World!&lt;/p&gt;";

//or with jQuery
$('#target').html('&lt;p&gt;Hello World!&lt;/p&gt;');
//or to repeatedly add content
$('#target').append('&lt;p&gt;Hello World!&lt;/p&gt;');</code></pre>
            <h4>Manufacture</h4>
            <p>The manufacture (part 1), however, is a little more tricky! To create new HTML we could just use javascript normally:</p>
          <div class="wrong-wrapper"><i class="fa fa-times wrong" aria-hidden="true"></i><pre><code class="language-javascript">//in jQuery
$('#target').html('&lt;div class="profile"&gt;&lt;dl&gt;&lt;dt&gt;Name:&lt;/dt&gt;&lt;dd&gt;' + person.name + '&lt;/dd&gt;&lt;dt&gt;Age:&lt;/dt&gt;&lt;dd&gt;' + person.age + '&lt;/dd&gt;&lt;dt&gt;Height:&lt;/dt&gt;&lt;dd&gt;' + person.height + '&lt;/dd&gt;&lt;/dl&gt;&lt;/div&gt;');

//or in native js
var profileFrag = document.createElement('DIV');
profileFrag.className = "profile";
profileFrag.innerHTML = "&lt;dl&gt;&lt;dt&gt;Name:&lt;/dt&gt;&lt;dd&gt;" + person.name + "&lt;/dd&gt;&lt;dt&gt;Age:&lt;/dt&gt;&lt;dd&gt;" + person.age + "&lt;/dd&gt;&lt;dt&gt;Height:&lt;/dt&gt;&lt;dd&gt;" + person.height + "&lt;/dd&gt;&lt;/dl&gt;"</code></pre></div>
            <p>As you can see, that's not very maintainable. These days we use a system called <strong>'Client-side Templating'</strong> that abstracts all that difficulty away! There are lots of templating libraries out there, but we are going to use <a href="http://handlebarsjs.com/">Handlebars</a>...</p>

            <article>
                <h2 class="guide-title">A Quick Guide to using Handlebars</h2>
                <ol class="hb-steps">
                    <li>Include the Handlebars script in the page (<a href="https://cdnjs.com/libraries/handlebars.js">CDN</a> or <a href="http://handlebarsjs.com/installation.html">local</a>)</li>
                    <li>
                        <p>Insert templates into the page using script tags, like:</p>
                        <pre class="language-html"><code>&lt;script id="my-template" type="text/x-handlebars-template"&gt;&lt;/script&gt;</code></pre>
                        <ol><li><strong>The <code>type</code> attribute must be set to <code class="lowercase">text/x-handlebars</code>!!</strong></li><li>Also, your template script block <strong>must have an id</strong> set on it in order to find and use the template...</li></ol>
                    </li>
                    <li>
                        <p>Inside those tags you add Handlebars templates that look like:</p>
                        <pre><code class="language-handlebars">&lt;script id="my-template" type="text/x-handlebars-template"&gt;
  &lt;div class="entry"&gt;
    &lt;h3&gt;{{title}}&lt;/h3&gt;
    &lt;div class="body"&gt;
      &lt;p&gt;{{body}}&lt;/p&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/script&gt;</code></pre>
                    </li>
                    <li>
                        <p>The next step is to use Handlebars to '<mark>compile</mark>' it. Handlebars takes the contents of that script block and turns it into a function that outputs html and inserts the values [that you will give later when you call that function].</p>
                        <pre><code class="language-javascript">var source   = $("#my-template").html(); //Gets template markup from inside the script tag
var template = Handlebars.compile(source); //Returns a function we'll use to create HTML chunks</code></pre>
                        <p>As you can see from the code above, <code>Handlebars</code> is a global variable. When you load the handlebars script it leaves an object full of helpful things inside the window object(<code>window.Handlebars</code>). This object is available to you when the page is loaded. Try typing <code>Handlebars</code>                            in your console (assuming the script is included) to inspect it.</p>
                    </li>
                    <li>Next you must get hold of the data that you want to display in that html. e.g. <pre><code class="language-javascript">var data = {title: "New HTML", body: "This is my templated content!"};</code></pre></li>
                    <li><p>You then call the template function we created above,  passing the data. This will return the new HTML:
                        <pre><code class="language-javascript">var html = template(data);</code></pre>
                      </p>
                      <p>This produces the HTML:</p>
                      <pre><code class="language-html">&lt;div class="entry"&gt;
  &lt;h3&gt;New HTML&lt;/h3&gt;
  &lt;div class="body"&gt;
    &lt;p&gt;This is my templated content!&lt;/p&gt;
  &lt;/div&gt;
&lt;/div&gt;</code></pre>
                    </li>
                    <li>Now insert it into the page: <pre><code class="language-javascript">$('#targetArea').html(html);</code></pre>
                    </li>
                </ol>
            </article>
        </div>
    </section>
    <section id="AJAX">
        <div class="container">
            <h2>AJAX</h2>
            <p><strong>To use ajax you need your page to be on a server</strong>: This can be a local server (i.e. running on your machine) or remote server. To create a quick and easy local server, I recommend <code>httpster</code>. Install it globally using npm: <code>npm i -g httpster</code></p>
            <p>To start the server navigate on the command line into the folder that this page is in and the simply type <code>httpster</code> and hit return. You will instructed to browse to something like <code>http://localhost:3333</code>. Do so.</p>
            <h3>What AJAX does</h3>
            <p>AJAX allows us to call out to servers (including our own) for resources after the page has been rendered. We can call for actual html files (known as 'partials') and insert them into our current page; javascript data files (<abbr title="JavaScript Object Notation">JSON</abbr> Files), or; we can call a server and ask for a response (which is typically <abbr title="JavaScript Object Notation">JSON</abbr>)</p>
            <h4>Introducing <abbr title="JavaScript Object Notation">JSON</abbr></h4>
            <p><abbr title="JavaScript Object Notation">JSON</abbr> is a <mark>'transport language'</mark>. It stands for <mark>'JavaScript Object Notation'</mark>. It allows the transport of JavaScript objects between locations.</p>
            <p><abbr title="JavaScript Object Notation">JSON</abbr> can be formed of <mark>objects or arrays</mark>, and is formatted like a normal javascript, except that: <ol><li><strong>strings must use double quotes</strong></li><li><strong>keys must be in double quotes too</strong></li></ol> So:
            <pre><code class="language-javascript">{
  name: 'james',
  age: 38,
  isTutor: true
}</code></pre>
            becomes
            <pre><code class="language-json">{
  "name": "james",
  "age": 38,
  "isTutor": true
}</code></pre>
          </p>
          <p>There is a global variable, <code>JSON</code>, available in your browser (<code>window.JSON</code>). The object is a helper object for dealing with <abbr title="JavaScript Object Notation">JSON</abbr>. If you type <code>JSON</code> into your console and hit return you'll be able to inspect it.</p>
          <p>Objects or Arrays can be turned into <abbr title="JavaScript Object Notation">JSON</abbr> using <code>JSON.stringify()</code> and back again using <code>JSON.parse()</code>. On AJAX calls the response is usually converted for you on receipt of a response.</p>
          <p><abbr title="For your information">FYI</abbr>, a <mark>collection</mark> is an array of objects. Data is often represented this way, with an object for each product or person and an array linking them together semantically.</p>
          <h3>Making our first AJAX call</h3>
            <p>Assuming you have a github account, try the following in your console: (You can obviously replace my username with yours to see what you get back.)</p>
            <pre><code class="language-javascript">$.ajax({
    method: 'GET', //optional. GET is the default if not provided
    context: document.body, //optional. Scopes the response to a part of your page
    url: '//api.github.com/users/jmsherry'
}).done(function(response){
    console.log(response);
}).fail(function(error){ //just to show you how to error catch
  console.error(error);
}).always(function(){ //this happens after EVERY ajax call
  console.info("ajax call made");
});</code></pre>
            <p>Once you get a response, lets build a template and inset your details into the page:</p>
            <pre><code class="language-javascript">var source   = $("#profile-template").html();
var template = Handlebars.compile(source);

$.ajax({
  url: '//api.github.com/users/jmsherry'
}).done(function(response){
  //create HTML
  var html = template(data);

  //insert new HTML
  $('#ajax-content').html(html);
});</code></pre>
            <div class="demo-area">
              <div class="demo-area-inner">
              <h3>Demo</h3>
                <div class="controls">
                    <button id="summoner" class="btn btn-primary">Call GitHub...</button>
                </div>
                <div id="ajax-content">Insert github profile here</div>
              </div>
            </div>
</div>
</section>


<!-- API SECTION -->
<section id="APIS">
  <div class="container">
            <h2>APIs</h2>
            <p>When you called GitHub you called a thing called an <abbr title="Application Program Interface">API</abbr> (<mark>Application Program Interface</mark>). APIs are set up by people/organisations to allow others to interact with their business through servers</p>
            <h3>REST APIs</h3>
            <h4>What is REST</h4>
            <p><abbr title="REspresentational State Transfer">REST</abbr> stands for <mark>REspresentational State Transfer</mark>. REST is a way of keeping the state of an application in sync on the client and the server. For example, if a user removes an item from their shopping basket on the client we send an HTTP <code>DELETE</code> request to remove it from the basket on the server too.</p>
            <h4>HTTP verbs/methods used in REST</h4>
            <div class="alert alert-info">
            <p>Disambiguation: HTTP VERB is a thing you use to <strong>do something</strong> using the http protocol itself. It is a method of doing something.</p>
            <p> In coding: <dl>
              <dt>Function</dt>
              <dd>A structure that allows code execution</dd>
              <dt>Method</dt>
              <dd>A way of doing something. May appear as a function itself and may contain functions</dd>
              <dt>Protocol</dt>
              <dd>An agreed way of doing something. It may contain agreed methods to achieve that end</dd>
              <dt>Verb</dt>
              <dd>One of those set up methods for doing something</dd>
            </dl></p>
          </div>
            <p>In development we have a thing called <mark><abbr title="Create, Read, Update &amp; Delete">CRUD</abbr> (Create, Read, Update &amp; Delete")</mark>. These are typical operations that you do with an app:</p>
    <table class="table table-bordered">
      <caption hidden>REST CRUD Relationship</caption>
        <thead>
            <tr>
                <th>Operation</th>
                <th>HTTP VERB (Method)</th>
                <th>Purpose</th>
            </tr>
        </thead>
        <tfoot hidden>
            <tr>
                <th></th>
                <th></th>
                <th></th>
            </tr>
        </tfoot>
        <tbody>
            <tr>
                <td><strong>Create</strong></td>
                <td><code>POST</code></td>
                <td>To send new data to the server.</td>
            </tr>
            <tr>
                <td><strong>Read</strong></td>
                <td><code>GET</code></td>
                <td>To retrieve an item/list of items from the server</td>
            </tr>
            <tr>
                <td><strong>Update</strong></td>
                <td><code>PUT</code></td>
                <td>To update the stored details of a record. e.g. Maybe the price of an item changed??</td>
            </tr>
            <tr>
                <td><strong>Delete</strong></td>
                <td><code>DELETE</code></td>
                <td>To indicate removal or deletion of a thing. (Server handles how)</td>
            </tr>
        </tbody>
    </table>
            <h4>Typical URL Format</h4>
            <p>The URL Structure is important in REST. Using the standard structure well documents the API for users (meaning that they can guess where to call to acheive their aims).</p>
            <p>An API has places you can call to, called <mark>routes</mark>. An example route might be: <code>http://tesco.com/groceries/fruit/apples</code>. This makes it easy to guess where you'd call to get oranges, right?!</p>
            <table class="table table-bordered">
                  <caption hidden>REST Routes</caption>
                    <thead>
                        <tr>
                            <th>HTTP Verb/Method</th>
                            <th>Route</th>
                            <th>Purpose</th>
                        </tr>
                    </thead>
                    <tfoot hidden>
                        <tr>
                            <th></th>
                            <th></th>
                            <th></th>
                        </tr>
                    </tfoot>
                    <tbody>
                        <tr>
                            <td><code>GET</code></td>
                            <td><code>/posts</code></td>
                            <td>Get all the posts</td>
                        </tr>
                        <tr>
                          <td><code>GET</code></td>
                          <td><code>/posts/1</code></td>
                          <td>Get a post with an id of 1</td>
                        </tr>
                        <tr>
                          <td><code>GET</code></td>
                          <td><code>/posts/1/comments</code></td>
                          <td>Get the comments from a post with an id of 1</td>
                        </tr>
                        <tr>
                          <td><code>GET</code></td>
                          <td><code>/comments?postId=1</code></td>
                          <td>Filter comments by id to get those related to a post with the id of 1 (Same as above but from a different angle.)</td>
                        </tr>
                        <tr>
                          <td><code>GET</code></td>
                          <td><code>/posts?userId=1</code></td>
                          <td>Get all posts made by the user with the id of 1</td>
                        </tr>
                        <tr>
                          <td><code>POST</code></td>
                          <td><code>/posts</code></td>
                          <td>Add a new post to the database. The '<mark>body</mark>' of this request would have an object in it, like: <code>{userId: 4, createdAt: 234877892, content: "hello world!"}</code></td>
                        </tr>
                        <tr>
                          <td><code>PUT</code></td>
                          <td><code>/posts/1</code></td>
                          <td>Also has a body which the server would use to update the post with an id of 1</td>
                        </tr>
                        <tr>
                          <td><code>DELETE</code></td>
                          <td><code>/posts/1</code></td>
                          <td>Delete the post with an id of 1</td>
                        </tr>
                    </tbody>
                </table>

            <h4>Testing APIs with Postman</h4>
            <p>Sometimes, rather than doing it in your console, you'll want to test ajax calls using a client program, so that the information is easier to see and you can configure the call better. I tend to use   <a href="https://www.getpostman.com/">Postman</a>. We'll just have a brief look at that.</p>
            <h4>jsonplaceholder</h4>
            <p>One public 'dummy' API you can use to test is <a href="https://jsonplaceholder.typicode.com/">https://jsonplaceholder.typicode.com/</a>. If you use Postman (or any ajax; or just your browser [in the case of <code>GET</code>s]) to make a request to it, then it will respond with data. Try making a get request to <a href="https://jsonplaceholder.typicode.com/photos">https://jsonplaceholder.typicode.com/photos</a>, or making a <code>PUT</code> request to <code>https://jsonplaceholder.typicode.com/users/1</code></p>
        </div>
    </section>

    <script id="entry-template" type="text/x-handlebars-template">
        <div class="alert alert-warning">
            {{body}}
        </div>
    </script>

    <script id="profile-template" type="text/x-handlebars-template">
        <div class="profile">
            <img src="{{avatar_url}}" alt="{{name}}'s avatar" width="200" height="200" class="img-rounded m-x-auto d-block">
            <dl>
                <dt>Name:</dt>
                <dd>{{name}}</dd>
                <dt>Company:</dt>
                <dd>{{company}}</dd>
                <dt>Email:</dt>
                <dd>{{email}}</dd>
            </dl>
        </div>
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.min.js"></script>

    <!-- Code highlighting stuff - Prism.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.4.1/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.4.1/components/prism-css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.4.1/components/prism-css-extras.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/components/prism-handlebars.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/components/prism-json.min.js"></script>



    <script src="./scripts/main.js"></script>
</body>

</html>
